from argparse import Namespace
from pyjfuzz.lib import *
import time
import requests

##

burp0_url = "http://192.168.2.229:80/stok=RjBoBk(khEhp42lbh2kpjp0jvhG0lk1X/ds"
burp0_headers = {"Accept": "application/json, text/javascript, */*; q=0.01", "X-Requested-With": "XMLHttpRequest", "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36", "Content-Type": "application/json; charset=UTF-8", "Origin": "http://192.168.2.229", "Referer": "http://192.168.2.229/", "Accept-Encoding": "gzip, deflate", "Accept-Language": "en-US,en;q=0.9", "Connection": "close"}
burp0_json={"method": "set", "tums_config": {"tums_info": {"comment": "21312", "enable": "off", "mfrs_id": "123", "port": "60443", "server": "123.123.123.123"}}}
res = requests.post(burp0_url, headers=burp0_headers, json=burp0_json)
##

print res.status_code,res.text

config = PJFConfiguration(Namespace(json=burp0_json, nologo=True, level=6))
fuzzer = PJFFactory(config)

msg =  fuzzer.fuzzed
res = requests.post(burp0_url, headers=burp0_headers, json=msg)
leng = len(res.text)


while True:
	try:
		msg =  fuzzer.fuzzed
		res = requests.post(burp0_url, headers=burp0_headers, json=msg, timeout=5)
		print(time.ctime(),res.status_code,res.text)
		if res.status_code>500 or len(res.text)!=leng:
			with open('log','a') as f:
				f.writelines('######### MSG #########\n')
				f.writelines(msg+'\n')
				f.writelines('######### res #########\n')
				f.writelines(res.text+'\n')
				f.writelines('\n')
	except requests.exceptions.RequestException as e:
		print(e)
		with open('log','a') as f:
			f.writelines('######### MSG #########\n')
			f.writelines(msg+'\n')
			f.writelines('######### res #########\n')
			f.writelines(res.text+'\n')
			f.writelines('\n')